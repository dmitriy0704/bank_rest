–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –î–º–∏—Ç—Ä–∏–π üí™ ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ—Ç —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ª–∏—á–∞–µ—Ç **—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** –æ—Ç **—Ä–µ–∞–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö**.
`Testcontainers` ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ**, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ**.
–†–∞–∑–±–µ—Ä—ë–º –≤—Å—ë –ø–æ —à–∞–≥–∞–º üëá

---

## üöÄ –ß—Ç–æ —Ç–∞–∫–æ–µ Testcontainers

**Testcontainers** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Java (–∏ Spring Boot),
–∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å **–Ω–∞—Å—Ç–æ—è—â–∏–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** –ø—Ä—è–º–æ –∏–∑ —Ç–µ—Å—Ç–æ–≤.
–ù–∞–ø—Ä–∏–º–µ—Ä:

* PostgreSQL, MySQL, MongoDB, Redis
* Kafka, RabbitMQ
* Keycloak, MinIO, ElasticSearch
* –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ

üì¶ –í—Å—ë –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º
–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî –Ω–∏–∫–∞–∫–æ–≥–æ –º—É—Å–æ—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.

---

## üß† –ß—Ç–æ –∏–º –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

Testcontainers –Ω—É–∂–µ–Ω –¥–ª—è **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤**, –≥–¥–µ —Ç—ã —Ö–æ—á–µ—à—å —É–±–µ–¥–∏—Ç—å—Å—è,
—á—Ç–æ —Ç–≤–æ–π –∫–æ–¥ —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –∞ –Ω–µ —Å –º–æ–∫–∞–º–∏.

| –¶–µ–ª—å —Ç–µ—Å—Ç–∞                                 | –ü–æ–¥—Ö–æ–¥–∏—Ç Testcontainers? | –ü—Ä–∏–º–µ—Ä                       |
| ------------------------------------------ | ------------------------ | ---------------------------- |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞               | ‚ùå –ù–µ—Ç (MockMvc)          | –º–æ–∫–Ω—É—Ç—ã–µ —Å–µ—Ä–≤–∏—Å—ã             |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤                    | ‚öôÔ∏è –ò–Ω–æ–≥–¥–∞                | –µ—Å–ª–∏ —Ç–∞–º SQL-–∑–∞–ø—Ä–æ—Å—ã         |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JPA/Repository —Å–ª–æ–π              | ‚úÖ –î–∞                     | —Ä–µ–∞–ª—å–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã         |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Kafka, MinIO, Redis | ‚úÖ –î–∞                     | –±—Ä–æ–∫–µ—Ä—ã, –æ—á–µ—Ä–µ–¥–∏ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É REST API + –ë–î    | ‚úÖ‚úÖ –î–∞                    | full-stack —Ç–µ—Å—Ç              |

---

## üß© –ü—Ä–∏–º–µ—Ä: PostgreSQL + Spring Boot

–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL.
–¢—ã —Ö–æ—á–µ—à—å —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å SQL (–∞ –Ω–µ —Å H2).

---

### 1Ô∏è‚É£ –î–æ–±–∞–≤—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–í `build.gradle` (–∏–ª–∏ `pom.xml`):

```groovy
testImplementation 'org.testcontainers:junit-jupiter'
testImplementation 'org.testcontainers:postgresql'
```

---

### 2Ô∏è‚É£ –ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º

```java
@SpringBootTest
@Testcontainers
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class CardRepositoryTest {

    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:16-alpine")
            .withDatabaseName("testdb")
            .withUsername("test")
            .withPassword("test");

    @Autowired
    private CardRepository cardRepository;

    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }

    @Test
    void shouldSaveAndFindCard() {
        CardEntity card = new CardEntity();
        card.setOpenNumber("1111 2222 3333 4444");
        card.setExpirationDate(LocalDate.of(2025, 10, 29));
        card.setBalance(123.45);
        cardRepository.save(card);

        var found = cardRepository.findById(card.getId());
        assertTrue(found.isPresent());
        assertEquals("1111 2222 3333 4444", found.get().getOpenNumber());
    }
}
```

---

### üîç –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

| –ß—Ç–æ                                          | –ó–∞—á–µ–º                                                  |
| -------------------------------------------- | ------------------------------------------------------ |
| `@Testcontainers`                            | –≥–æ–≤–æ—Ä–∏—Ç JUnit, —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã            |
| `@Container`                                 | —Å–æ–∑–¥–∞—ë—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç PostgreSQL-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º             |
| `DynamicPropertySource`                      | –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ Spring Boot        |
| `@AutoConfigureTestDatabase(replace = NONE)` | –æ—Ç–∫–ª—é—á–∞–µ—Ç H2, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä             |
| `CardRepository`                             | —Ä–µ–∞–ª—å–Ω—ã–π Spring Data —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π                       |
| –í —Ç–µ—Å—Ç–µ                                      | –º—ã —Ä–µ–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ —á–∏—Ç–∞–µ–º –∏–∑ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |

---

## üß± –ß—Ç–æ –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å Testcontainers

| –¢–∏–ø —Ç–µ—Å—Ç–∞                   | –ü—Ä–∏–º–µ—Ä                                                          |
| --------------------------- | --------------------------------------------------------------- |
| **Repository-—Ç–µ—Å—Ç—ã**        | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ (`@Query`, join‚Äô—ã, —Ñ–∏–ª—å—Ç—Ä—ã)           |
| **Service-—Ç–µ—Å—Ç—ã**           | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∞–ª—å–Ω–æ —Ö–æ–¥–∏—Ç –≤ –ë–î             |
| **Full Integration (REST)** | –ü–æ–¥–Ω—è—Ç—å –≤–µ—Å—å Spring Boot –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `/api/v1/cards` |
| **Kafka —Ç–µ—Å—Ç—ã**             | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è/—á–∏—Ç–∞—é—Ç—Å—è           |
| **MinIO/S3 —Ç–µ—Å—Ç—ã**          | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤                          |
| **Keycloak —Ç–µ—Å—Ç—ã**          | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ JWT                                    |

---

## ‚ö° –ü—Ä–∏–º–µ—Ä Full Integration Test (REST + PostgreSQL)

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@Testcontainers
@AutoConfigureMockMvc
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class CardControllerIT {

    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:16-alpine")
            .withDatabaseName("testdb")
            .withUsername("test")
            .withPassword("test");

    @DynamicPropertySource
    static void postgresProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Autowired
    private CardRepository cardRepository;

    @Test
    void shouldCreateCardInRealDatabase() throws Exception {
        String json = """
            {
              "openNumber": "6318 0172 1681 9169",
              "expirationDate": "2025-10-29",
              "balance": 123.4,
              "userId": 1
            }
        """;

        mockMvc.perform(post("/api/v1/cards/create-card")
                .contentType(MediaType.APPLICATION_JSON)
                .content(json))
            .andExpect(status().isCreated());

        assertEquals(1, cardRepository.count());
    }
}
```

üì¶ –≠—Ç–æ—Ç —Ç–µ—Å—Ç:

* –∑–∞–ø—É—Å–∫–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–π PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**,
* —Å—Ç–∞—Ä—Ç—É–µ—Ç **–≤–µ—Å—å Spring Boot –∫–æ–Ω—Ç–µ–∫—Å—Ç**,
* –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π HTTP POST —á–µ—Ä–µ–∑ MockMvc,
* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞–ø–∏—Å—å —Ä–µ–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –≤ –±–∞–∑–µ.

---

## üß† –ò—Ç–æ–≥–æ

| –¶–µ–ª—å                                         | –ö–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥                         |
| -------------------------------------------- | ------------------------------------ |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã                        | `@WebMvcTest` + –º–æ–∫–∏                 |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –∏ –ë–î                        | `@SpringBootTest` + Testcontainers   |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã JPA             | `@DataJpaTest` + Testcontainers      |
| –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Kafka / Redis / MinIO | `@SpringBootTest` + –Ω—É–∂–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |

---

–•–æ—á–µ—à—å, —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** —Å—Ä–∞–∑—É ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä PostgreSQL + Redis, –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ –æ–¥–Ω–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ç–µ—Å—Ç–µ?
